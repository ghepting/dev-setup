#!/usr/bin/env zsh

ZSHRC_FILE="$HOME/.zshrc"

# colors
RED="\e[31m"
GREEN="\e[32m"
YELLOW="\e[33m"
BLUE="\e[34m"
MAGENTA="\e[35m"
CYAN="\e[36m"
WHITE="\e[37m"
NC="\e[0m" # No Color (Reset)

RESTART_REQUIRED=false

# source utility functions
source "./lib/brew.sh"
source "./lib/ruby.sh"
source "./lib/python.sh"
source "./lib/node.sh"
source "./lib/packages.sh"
source "./lib/vim_tmux.sh"
source "./lib/1password.sh"
source "./lib/dotfiles.sh"

# install homebrew
install_homebrew

# install google drive
brew install --cask google-drive
open /Applications/Google\ Drive.app
# pause for user to login to google drive
read -p "Press [Enter] after logging in to Google Drive..."

# google drive dotfiles
symlink_google_drive_dotfiles

# add homebrew to path
install_homebrew_path

# homebrew and formulae
install_homebrew_formulae

# ruby and rbenv
install_rbenv_and_ruby

# python and pyenv
install_pyenv_and_python

# print version of each of the Brewfile packages
echo -e "${BLUE}Using $(docker --version)${NC}"
echo -e "${BLUE}Using docker compose $(docker compose version --short)${NC}"
echo -e "${BLUE}Using $(tmux -V)${NC}"
echo -e "${BLUE}Using vim $(vim --version | head -n 1 | sed -E 's/.*([0-9]+\.[0-9]+).*/\1/')${NC}"
echo -e "${BLUE}Using direnv $(direnv --version)${NC}"
echo -e "${BLUE}Using antigravity $(agy -v 2>/dev/null | grep -E --color=no '^[0-9]+\.[0-9]+\.[0-9]+$')${NC}"
echo -e "${BLUE}Using postman $(defaults read /Applications/Postman.app/Contents/Info.plist CFBundleShortVersionString)${NC}"
echo -e "${BLUE}Using $(ngrok --version)${NC}"
echo -e "${BLUE}Using google drive $(defaults read /Applications/Google\ Drive.app/Contents/Info.plist CFBundleShortVersionString)${NC}"

# node/npm, and nvm
install_nvm_and_node

# vim & tmux
setup_vim_tmux_config

# 1password and SSH agent
setup_1password

# global npm packages
install_global_npm_packages

# TODO: setup iterm2 w/solarized

# TODO: setup zsh git context

# TODO: setup symlinks for dotfiles in google drive (w/prompt as this step is optional)

echo -e "${GREEN}Dev setup completed successfully${NC}"
if $RESTART_REQUIRED
then
  echo -e "${YELLOW}You may need to restart your terminal${NC}"
fi
exit 0
